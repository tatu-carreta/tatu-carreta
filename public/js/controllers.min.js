"use strict";angular.module("app",["angularFileUpload","ngImgCrop"],function(e){e.startSymbol("<%"),e.endSymbol("%>")}).controller("ImagenSingular",["$scope","FileUploader",function(e,n){function o(){e.uploader.url=e.url_public+"/admin/imagen/crop/upload"}e.size="small",e.type="square",e.image="",e.croppedImage="",e.resImgFormat="image/png",e.resImgQuality=1,e.selMinSize=100,e.resImgSize=280,e.url="",e.original="",e.todo_error=!1,e.$watch("url_public",o,!0),e.removerImagen=function(){a.clearQueue(),e.image="",e.croppedImage="",angular.element(document.querySelector("#fileInput")).val(""),angular.element(document.querySelector(".url-archivo1")).val(""),angular.element(document.querySelector("#epigrafe")).val("")},e.onChange=function(n){console.log("onChange fired - "+e.foto._file);var o=l(n);e.foto._file=o,console.log("onChange fired - "+e.foto._file.type)},e.onLoadBegin=function(){console.log("onLoadBegin fired")},e.onLoadDone=function(){console.log("onLoadDone fired")},e.onLoadError=function(){console.log("onLoadError fired")};var i=function(n){var o=n.currentTarget.files[0],i=new FileReader;i.onload=function(n){e.$apply(function(e){e.imageDataURI=n.target.result})},i.readAsDataURL(o)};angular.element(document.querySelector("#fileInput")).on("change",i),e.$watch("resImageDataURI",function(){});var a=e.uploader=new n({url:"admin/imagen/crop/upload"});a.filters.push({name:"customFilter",fn:function(e,n){return this.queue.length<1},texto:"Está intentando cargar una imagen nueva"}),a.filters.push({name:"sizeLimit",fn:function(e,n){return e.size<5e5},texto:"La imagen no debe exceder los 500kb de peso."}),a.onWhenAddingFileFailed=function(e,n,o){console.info("onWhenAddingFileFailed",e,n,o),alert(n.texto)},a.onAfterAddingFile=function(n){e.original=n._file,e.foto=n;var o=new FileReader;o.onload=function(n){e.$apply(function(){e.image=n.target.result})},o.readAsDataURL(n._file)},a.onBeforeUploadItem=function(n){var o=l(e.croppedImage);n._file=o};var l=function(e){for(var n=atob(e.split(",")[1]),o=e.split(",")[0].split(":")[1].split(";")[0],i=[],a=0;a<n.length;a++)i.push(n.charCodeAt(a));return new Blob([new Uint8Array(i)],{type:o})};a.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},a.onBeforeUploadItem=function(n){n.formData.push({imagen_ampliada:e.original}),console.info("onBeforeUploadItem",n,e.original)},a.onProgressItem=function(e,n){console.info("onProgressItem",e,n)},a.onProgressAll=function(e){console.info("onProgressAll",e)},a.onSuccessItem=function(e,n,o,i){console.info("onSuccessItem",e,n,o,i)},a.onErrorItem=function(e,n,o,i){console.info("onErrorItem",e,n,o,i)},a.onCancelItem=function(e,n,o,i){console.info("onCancelItem",e,n,o,i)},a.onCompleteItem=function(n,o,i,a){console.info("onCompleteItem",o),angular.isUndefined(o.imagen_path)?e.todo_error=!0:(e.imagen_portada=o.imagen_path,e.imagen_ampliada=o.imagen_ampliada)},a.onCompleteAll=function(){console.info("onCompleteAll"),e.todo_error||(e.todo_ok=!0)},console.info("uploader",a)}]).controller("ImagenMultiple",["$scope","FileUploader",function(e,n){function o(){e.uploader.url=e.url_public+"/admin/imagen/crop/upload"}e.size="small",e.type="square",e.image="",e.croppedImage="",e.resImgFormat="image/png",e.resImgQuality=1,e.selMinSize=100,e.resImgSize=280,e.original="",e.imagenes_seleccionadas=[],e.removerImagen=function(){a.clearQueue(),e.image="",e.croppedImage="",angular.element(document.querySelector("#fileInput")).val(""),angular.element(document.querySelector(".url-archivo1")).val(""),angular.element(document.querySelector("#epigrafe")).val("")},e.onChange=function(n){console.log("onChange fired - "+e.foto._file);var o=l(n);e.foto._file=o,console.log("onChange fired - "+e.foto._file.type)},e.onLoadBegin=function(){console.log("onLoadBegin fired")},e.onLoadDone=function(){console.log("onLoadDone fired")},e.onLoadError=function(){console.log("onLoadError fired")};var i=function(n){var o=n.currentTarget.files[0],i=new FileReader;i.onload=function(n){e.$apply(function(e){e.imageDataURI=n.target.result})},i.readAsDataURL(o)};angular.element(document.querySelector("#fileInput")).on("change",i),e.$watch("resImageDataURI",function(){}),e.$watch("url_public",o,!0);var a=e.uploader=new n({url:"admin/imagen/crop/upload"});a.filters.push({name:"customFilter",fn:function(e,n){return this.queue.length<1},texto:"Está intentando cargar una imagen nueva"}),a.filters.push({name:"sizeLimit",fn:function(e,n){return e.size<5e5},texto:"Excede los 500kb"}),a.onWhenAddingFileFailed=function(e,n,o){console.info("onWhenAddingFileFailed",e,n,o),alert(n.texto)},a.onAfterAddingFile=function(n){e.original=n._file,e.foto=n;var o=new FileReader;o.onload=function(n){e.$apply(function(){e.image=n.target.result})},o.readAsDataURL(n._file)},a.onBeforeUploadItem=function(n){var o=l(e.croppedImage);n._file=o};var l=function(e){for(var n=atob(e.split(",")[1]),o=e.split(",")[0].split(":")[1].split(";")[0],i=[],a=0;a<n.length;a++)i.push(n.charCodeAt(a));return new Blob([new Uint8Array(i)],{type:o})};a.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},a.onBeforeUploadItem=function(n){n.formData.push({imagen_ampliada:e.original}),console.info("onBeforeUploadItem",n,e.original)},a.onProgressItem=function(e,n){console.info("onProgressItem",e,n)},a.onProgressAll=function(e){console.info("onProgressAll",e)},a.onSuccessItem=function(e,n,o,i){console.info("onSuccessItem",e,n,o,i)},a.onErrorItem=function(e,n,o,i){console.info("onErrorItem",e,n,o,i)},a.onCancelItem=function(e,n,o,i){console.info("onCancelItem",e,n,o,i)},a.onCompleteItem=function(n,o,i,a){console.info("onCompleteItem",o),e.imagen_portada=o.imagen_path,e.imagen_ampliada=o.imagen_ampliada;var l={imagen_portada_ampliada:e.imagen_ampliada,src:e.croppedImage,epigrafe:angular.element(document.querySelector("#epigrafe")).val(),imagen_portada:e.imagen_portada};e.imagenes_seleccionadas.push(l),e.removerImagen(),console.log(e.imagenes_seleccionadas)},a.onCompleteAll=function(){console.info("onCompleteAll")},e.borrarImagenCompleto=function(n){confirm("¿Está segura que desea eliminar esta imagen?")&&e.imagenes_seleccionadas.splice(n,1)},console.info("uploader",a)}]).controller("GaleriaUpload",["$scope","FileUploader",function(e,n){function o(){e.uploader.url=e.url_public+"/admin/imagen/slide/upload"}function i(){e.nombres_archivos="",angular.forEach(a.queue,function(n){e.nombres_archivos+=n.file.name+";   "})}e.imagenes_seleccionadas=[],e.nombres_archivos="",e.$watch("url_public",o,!0);var a=e.uploader=new n({url:"admin/imagen/slide/upload"});a.filters.push({name:"customFilter",fn:function(n,o){return this.queue.length<e.total_permitido},texto:"Está intentando cargar más de las 4 imágenes permitidas."}),a.filters.push({name:"sizeLimit",fn:function(e,n){return e.size<5e5},texto:"La imagen no debe exceder los 500kb de peso."}),a.filters.push({name:"imageFilter",fn:function(e,n){var o="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(o)}}),a.onWhenAddingFileFailed=function(e,n,o){console.info("onWhenAddingFileFailed",e,n,o)},a.onAfterAddingFile=function(e){i(),console.info("onAfterAddingFile",e)},a.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},a.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e)},a.onProgressItem=function(e,n){console.info("onProgressItem",e,n)},a.onProgressAll=function(e){console.info("onProgressAll",e)},a.onSuccessItem=function(e,n,o,i){console.info("onSuccessItem",e,n,o,i)},a.onErrorItem=function(e,n,o,i){console.info("onErrorItem",e,n,o,i)},a.onCancelItem=function(e,n,o,i){console.info("onCancelItem",e,n,o,i)},a.onCompleteItem=function(n,o,i,a){console.info("onCompleteItem",n,o,i,a);var l={imagen_slide:o.imagen_path};e.imagenes_seleccionadas.push(l)},a.onCompleteAll=function(){console.info("onCompleteAll")},e.removeItem=function(e){e.remove(),i()},e.removeTodos=function(e){a.clearQueue(),i()},console.info("uploader",a)}]);